from __future__ import annotations

from datetime import datetime, timezone, date

from app.schemas.news import (
    GithubRepoRead,
    NewsArticleRead,
    NewsPayload,
    NewsSourceRead,
    WeeklyDigestRead,
)


def _ts(value: str) -> datetime:
    """Return timezone-aware datetime from ISO 8601 string."""
    return datetime.fromisoformat(value.replace("Z", "+00:00")).astimezone(timezone.utc)


NEWS_SOURCES: list[NewsSourceRead] = [
    NewsSourceRead(
        id="openai",
        name="OpenAI",
        url="https://openai.com/blog",
        gradient=("#06B6D4", "#10B981"),
        weight=1.0,
    ),
    NewsSourceRead(
        id="anthropic",
        name="Anthropic",
        url="https://www.anthropic.com/news",
        gradient=("#8B5CF6", "#F59E0B"),
        weight=0.96,
    ),
    NewsSourceRead(
        id="deepmind",
        name="Google DeepMind",
        url="https://blog.google/technology/google-deepmind/",
        gradient=("#2563EB", "#FBBF24"),
        weight=0.94,
    ),
    NewsSourceRead(
        id="xai",
        name="xAI",
        url="https://x.ai/blog",
        gradient=("#0F172A", "#2563EB"),
        weight=0.9,
    ),
    NewsSourceRead(
        id="perplexity",
        name="Perplexity",
        url="https://www.perplexity.ai/blog",
        gradient=("#0EA5E9", "#F97316"),
        weight=0.88,
    ),
    NewsSourceRead(
        id="meta",
        name="Meta AI",
        url="https://ai.meta.com/blog",
        gradient=("#A47CFB", "#F0A7AE"),
        weight=0.84,
    ),
    NewsSourceRead(
        id="mistral",
        name="Mistral AI",
        url="https://mistral.ai/news",
        gradient=("#EDB55F", "#5FD1E3"),
        weight=0.82,
    ),
    NewsSourceRead(
        id="huggingface",
        name="Hugging Face",
        url="https://huggingface.co/blog",
        gradient=("#5CC4A2", "#8E9FF9"),
        weight=0.8,
    ),
    NewsSourceRead(
        id="microsoft",
        name="Microsoft AI",
        url="https://blogs.microsoft.com/ai/",
        gradient=("#2A3A70", "#5FD1E3"),
        weight=0.78,
    ),
    NewsSourceRead(
        id="stability",
        name="Stability AI",
        url="https://stability.ai/news",
        gradient=("#EDB55F", "#E667A8"),
        weight=0.74,
    ),
]

PLACEHOLDER_ARTICLES: list[NewsArticleRead] = [
    NewsArticleRead(
        id="2025-09-openai-gpt5",
        title="OpenAI launches GPT-5 with unified realtime intelligence",
        slug="openai-gpt-5-launch",
        source_id="openai",
        url="https://openai.com/blog/introducing-gpt-5",
        summary="GPT-5 arrives with a one-million token context window, hybrid symbolic-neural reasoning, and agent-native APIs for assistants.",
        tags=["gpt-5", "multimodal", "agents"],
        published_at=_ts("2025-09-12T15:30:00Z"),
        score=98.0,
        github_repo=None,
        hero_image="https://openai.com/content/images/gpt-5-card.jpg",
        content=[
            "GPT-5 introduces dynamic context folding, giving teams a million-token working memory with low-latency streaming.",
            "OpenAI's new Agent API orchestrates assistants that handle tool routing, background jobs, and realtime collaboration across channels.",
            "Pricing tiers include dedicated throughput for enterprise copilots plus on-device student editions.",
        ],
    ),
    NewsArticleRead(
        id="2025-08-anthropic-claude-4-2-sonnet",
        title="Anthropic unveils Claude 4.2 Sonnet for regulated automations",
        slug="anthropic-claude-4-2-sonnet",
        source_id="anthropic",
        url="https://www.anthropic.com/news/claude-4-2-sonnet",
        summary="Claude 4.2 Sonnet adds evidence tracing, 320K context, and compliance-grade workflow auditing for enterprises.",
        tags=["claude", "enterprise", "compliance"],
        published_at=_ts("2025-08-21T17:00:00Z"),
        score=95.0,
        github_repo=None,
        hero_image="https://www.anthropic.com/assets/claude-4-2-card.jpg",
        content=[
            "Anthropic shipped Policy Trace so reviewers can replay tool calls, prompts, and guardrails across long automations.",
            "The upgraded Claude Workbench delivers low-latency 320K context navigation with multi-user editing.",
            "New pricing bundles pair Claude 4.2 with Anthropic's retrieval and knowledge graph services.",
        ],
    ),
    NewsArticleRead(
        id="2025-07-gemini-2-5-pro",
        title="Google DeepMind ships Gemini 2.5 Pro with live video reasoning",
        slug="google-gemini-2-5-pro",
        source_id="deepmind",
        url="https://deepmind.google/announcements/gemini-2-5-pro",
        summary="Gemini 2.5 Pro interprets streaming video, schedules multi-agent plans, and integrates across Workspace automations.",
        tags=["gemini", "multimodal", "workspace"],
        published_at=_ts("2025-07-30T14:00:00Z"),
        score=94.0,
        github_repo=None,
        hero_image="https://deepmind.google/static/gemini-2-5-card.jpg",
        content=[
            "Gemini 2.5 Pro introduces cross-modal retrieval spanning video, audio, and documents in a million-token buffer.",
            "Developers gain new Flow Studio templates for combining Gemini with Vertex AI Agent Builder and AppSheet.",
            "Safety updates include contextual watermarking and partner-verifiable audit logs.",
        ],
    ),
    NewsArticleRead(
        id="2025-06-xai-grok-4",
        title="xAI releases Grok 4 with open alignment data",
        slug="xai-grok-4-release",
        source_id="xai",
        url="https://x.ai/blog/grok-4",
        summary="Grok 4 expands xAI's MoE architecture, shipping multilingual reasoning, grounded citations, and a public safety tuning dataset.",
        tags=["grok", "xai", "alignment"],
        published_at=_ts("2025-06-26T19:45:00Z"),
        score=92.0,
        github_repo=None,
        hero_image="https://x.ai/assets/grok-4-card.jpg",
        content=[
            "Grok 4 adds an Open Alignment initiative sharing red-team traces and safety benchmarks with researchers.",
            "Developers can deploy Grok 4 via xAI's API or self-host the compact Grok Lite variant for on-prem workloads.",
            "New reasoning kernels improve maths, planning, and guarded tool execution across devops workflows.",
        ],
    ),
    NewsArticleRead(
        id="2025-05-perplexity-sonar-ultra",
        title="Perplexity debuts Sonar Ultra with autonomous research agents",
        slug="perplexity-sonar-ultra",
        source_id="perplexity",
        url="https://www.perplexity.ai/blog/sonar-ultra",
        summary="Sonar Ultra layers multi-agent browsing, fact graphs, and live dashboards over Perplexity's hybrid search stack.",
        tags=["perplexity", "research", "agents"],
        published_at=_ts("2025-05-28T13:15:00Z"),
        score=90.0,
        github_repo=None,
        hero_image="https://assets.perplexity.ai/sonar-ultra-card.jpg",
        content=[
            "Perplexity launched Sonar Ultra for analysts who need autonomous research with verifiable citations.",
            "The release adds fact graph visualisations, Slack alerts, and follow-up query automation.",
            "Enterprise plans bundle governance dashboards and redactable research notebooks.",
        ],
    ),
    NewsArticleRead(
        id="2025-05-microsoft-phi-4",
        title="Microsoft introduces Phi-4 for Copilot+ PCs and Azure Edge",
        slug="microsoft-phi-4",
        source_id="microsoft",
        url="https://blogs.microsoft.com/ai/introducing-phi-4",
        summary="Phi-4 blends efficient transformers with neural radiance caching, powering next-gen on-device copilots and edge inference.",
        tags=["microsoft", "phi-4", "edge"],
        published_at=_ts("2025-05-09T16:10:00Z"),
        score=88.0,
        github_repo=GithubRepoRead(full_name="microsoft/phi-4-spec", stars=12800, delta_stars=920),
        hero_image="https://blogs.microsoft.com/wp-content/uploads/2025/05/phi-4-card.jpg",
        content=[
            "Phi-4 ships with quantisation profiles for Copilot+ PCs, Azure Sphere, and HoloLens 3 reference designs.",
            "Microsoft released Responsible AI evaluation packs and open-sourced its safety harness for edge deployments.",
            "A new Phi Playground helps developers fuse sensor data and LLM reasoning for industrial inspection workflows.",
        ],
    ),
    NewsArticleRead(
        id="2025-04-meta-llama4",
        title="Meta open-sources Llama 4 120B with streaming adapters",
        slug="meta-llama-4-120b",
        source_id="meta",
        url="https://ai.meta.com/blog/llama-4/",
        summary="Llama 4 120B Instruct arrives with fast adapters, mixture routing, and a Responsible Use license for commercial teams.",
        tags=["meta", "open-source", "llama4"],
        published_at=_ts("2025-04-18T12:00:00Z"),
        score=87.0,
        github_repo=GithubRepoRead(full_name="meta-llama/llama4", stars=58000, delta_stars=4100),
        hero_image="https://ai.meta.com/static/llama4-card.jpg",
        content=[
            "Meta launched Llama 4 with a new streaming adapter system that lowers latency on commodity GPUs.",
            "Instruction-tuned checkpoints cover multilingual chat, code, and scientific reasoning tasks.",
            "The release includes Llama Guard 4 alignment artifacts and partner audits for transparency.",
        ],
    ),
    NewsArticleRead(
        id="2025-04-mistral-next",
        title="Mistral announces Mistral Next 12x24B for retrieval-native apps",
        slug="mistral-next-12x24b",
        source_id="mistral",
        url="https://mistral.ai/news/mistral-next-12x24b",
        summary="Mistral Next leverages a MoE architecture optimised for retrieval-augmented generation and multi-agent routing.",
        tags=["mistral", "moe", "rag"],
        published_at=_ts("2025-04-02T10:00:00Z"),
        score=86.0,
        github_repo=None,
        hero_image="https://mistral.ai/images/mistral-next-card.jpg",
        content=[
            "Mistral Next 12x24B improves expert sparsity for lower latency while matching dense model accuracy.",
            "The company introduced Retrieval Profiles to tune grounding behaviour across proprietary knowledge bases.",
            "Partners can deploy via managed endpoints, on-prem clusters, or NVIDIA DGX Cloud.",
        ],
    ),
    NewsArticleRead(
        id="2025-03-huggingface-cascade",
        title="Hugging Face and AWS release Cascade for open multimodal alignment",
        slug="huggingface-cascade",
        source_id="huggingface",
        url="https://huggingface.co/blog/cascade",
        summary="Cascade is a family of open multimodal models trained on curated audio, video, and document corpora with transparent licensing.",
        tags=["huggingface", "multimodal", "open"],
        published_at=_ts("2025-03-19T11:20:00Z"),
        score=84.0,
        github_repo=GithubRepoRead(full_name="huggingface/cascade", stars=9200, delta_stars=680),
        hero_image="https://huggingface.co/blog/assets/cascade/cascade-card.jpg",
        content=[
            "Cascade models focus on open evaluation and auditable data pipelines with dataset cards for every modality.",
            "AWS and Hugging Face provide deployment recipes on Bedrock, SageMaker, and serverless inference.",
            "The project ships with evaluation scripts covering DocVQA, VideoQA, and audio captioning benchmarks.",
        ],
    ),
    NewsArticleRead(
        id="2025-02-stability-sd4",
        title="Stability AI previews Stable Diffusion 4 with neural render fusion",
        slug="stability-stable-diffusion-4",
        source_id="stability",
        url="https://stability.ai/news/stable-diffusion-4",
        summary="Stable Diffusion 4 combines diffusion transformers and neural radiance caching for higher fidelity controllable imagery.",
        tags=["stability", "image", "open-source"],
        published_at=_ts("2025-02-12T09:30:00Z"),
        score=82.0,
        github_repo=None,
        hero_image="https://stability.ai/images/sd4-card.jpg",
        content=[
            "Stable Diffusion 4 adds dual-path rendering for crisp typography, photoreal faces, and cinematic lighting controls.",
            "Stability introduced a creator license allowing commercial use with attribution-based incentives.",
            "Partners can join the Studio Alpha program for direct feedback loops and dataset contributions.",
        ],
    ),
]

WEEKLY_DIGEST = WeeklyDigestRead(
    week_of=date(2025, 9, 15),
    headline="Weekly Digest | GPT-5, Claude 4.2, and Gemini 2.5 headline a breakthrough week",
    summary=(
        "OpenAI, Anthropic, and Google DeepMind launched new flagship models while xAI and Perplexity rolled out agent upgrades."
    ),
    article_ids=[
        "2025-09-openai-gpt5",
        "2025-08-anthropic-claude-4-2-sonnet",
        "2025-07-gemini-2-5-pro",
        "2025-06-xai-grok-4",
        "2025-05-perplexity-sonar-ultra",
    ],
)

NEWS_PAYLOAD = NewsPayload(sources=NEWS_SOURCES, articles=PLACEHOLDER_ARTICLES, digest=WEEKLY_DIGEST)
